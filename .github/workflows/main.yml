name: Node.js Vulnerability Check

on: [push, pull_request]

jobs:
  check-vulnerabilities:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Use Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '>=18.19.0' # Specify the Node.js version you want to test against
        check-latest: true

    - name: Run Vulnerability Scan
      run: npm audit --json

    - name: Fix Vulnerabilities
      run: npm audit fix --force --json
    
    - name: Cache
      uses: actions/cache@v3.3.2
      with:
        # A list of files, directories, and wildcard patterns to cache and restore
        path: '/'
        # An explicit key for restoring and saving the cache
        key: npm-feature-d5ea0750
        # An ordered list of keys to use for restoring stale cache if no cache hit occurred for key. Note `cache-hit` returns false in this case.
        restore-keys: # optional
        # The chunk size used to split up large files during upload, in bytes
        upload-chunk-size: # optional
        # An optional boolean when enabled, allows windows runners to save or restore caches that can be restored or saved respectively on other platforms
        enableCrossOsArchive: # optional, default is false
        # Fail the workflow if cache entry is not found
        fail-on-cache-miss: # optional, default is false
        # Check if a cache entry exists for the given input(s) (key, restore-keys) without downloading the cache
        lookup-only: # optional, default is false
              
